{% extends "base.html" %}
{% block content %}

<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
    <title>Home</title>
</head>
<div class="book-app">
    <div class="header">
        <h1>Popular Books</h1>
    </div>
    <section class="carousel-section">
        <div class="header" margin-top="50px">
            <h2>Fiction Books</h2>
        </div>
        <div class="carousel-container">
            <button class="nav-button left" onclick="scrollCarousel(-1, 'trending')">
                &#8249;
            </button>
            <div class="card-carousel" id="carousel-trending" data-scroll-position="0">
                {% for book in trending_books %}
                <div class="card">
                    <div class="cover">
                        <img src="{{ book.cover_url }}" alt="Cover image of {{ book.title }}" class="cover-image" />
                    </div>
                    <h3>{{ book.title }}</h3>
                    <p class="author">By {{ book.author }}</p>
                    <div class="button-container">
                        <a href="{{ url_for('book_details_nyt', title=book.title) }}" class="btn">Learn More</a>
                        <form action="{{ url_for('add_book') }}" method="post">
                            <input type="hidden" name="title" value="{{ book.title }}">
                            <input type="hidden" name="author" value="{{ book.author }}">
                            <input type="hidden" name="cover_url" value="{{ book.cover_url }}">
                            <input type="hidden" name="infoLink" value="{{ book.infoLink }}">
                            <button type="submit" class="fa" title="Add to list">★</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="nav-button right" onclick="scrollCarousel(1, 'trending')">
                &#8250;
            </button>
        </div>
    </section>

    <section class="carousel-section">
        <div class="header">
            <h2>Non-Fiction Books</h2>
        </div>
        <div class="carousel-container">
            <button class="nav-button left" onclick="scrollCarousel(-1, 'bestseller')">
                &#8249;
            </button>
            <div class="card-carousel" id="carousel-bestseller" data-scroll-position="0">
                {% for book in bestseller_books %}
                <div class="card">
                    <div class="cover">
                        <img src="{{ book.cover_url }}" alt="Cover image of {{ book.title }}" class="cover-image" />
                    </div>
                    <h3>{{ book.title }}</h3>
                    <p class="author">By {{ book.author }}</p>
                    <div class="button-container">
                        <a href="{{ url_for('book_details_nyt', title=book.title) }}" class="btn">Learn More</a>
                        <form action="{{ url_for('add_book') }}" method="post">
                            <input type="hidden" name="title" value="{{ book.title }}">
                            <input type="hidden" name="author" value="{{ book.author }}">
                            <input type="hidden" name="cover_url" value="{{ book.cover_url }}">
                            <input type="hidden" name="infoLink" value="{{ book.infoLink }}">
                            <button type="submit" class="fa" title="Add to list">★</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="nav-button right" onclick="scrollCarousel(1, 'bestseller')">
                &#8250;
            </button>
        </div>
    </section>

    <section class="carousel-section">
        <div class="header">
            <h2>Young Adult Books</h2>
        </div>
        <div class="carousel-container">
            <button class="nav-button left" onclick="scrollCarousel(-1, 'young')">
                &#8249;
            </button>
            <div class="card-carousel" id="carousel-young" data-scroll-position="0">
                {% for book in young_books %}
                <div class="card">
                    <div class="cover">
                        <img src="{{ book.cover_url }}" alt="Cover image of {{ book.title }}" class="cover-image" />
                    </div>
                    <h3>{{ book.title }}</h3>
                    <p class="author">By {{ book.author }}</p>
                    <div class="button-container">
                        <a href="{{ url_for('book_details_nyt', title=book.title) }}" class="btn">Learn More</a>
                        <form action="{{ url_for('add_book') }}" method="post">
                            <input type="hidden" name="title" value="{{ book.title }}">
                            <input type="hidden" name="author" value="{{ book.author }}">
                            <input type="hidden" name="cover_url" value="{{ book.cover_url }}">
                            <input type="hidden" name="infoLink" value="{{ book.infoLink }}">
                            <button type="submit" class="fa" title="Add to list">★</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="nav-button right" onclick="scrollCarousel(1, 'young')">
                &#8250;
            </button>
        </div>
    </section>
</div>


<script>
    function scrollCarousel(direction, carouselId) {
        const carousel = document.getElementById(`carousel-${carouselId}`);
        const cardWidth = document.querySelector('.card').offsetWidth + 20; // Width + margin
        const visibleCards = Math.floor(carousel.parentElement.offsetWidth / cardWidth);
        const maxPosition = carousel.children.length - visibleCards;
        let currentPosition = parseInt(carousel.getAttribute('data-scroll-position'));

        currentPosition = Math.max(0, Math.min(currentPosition + direction, maxPosition));
        carousel.setAttribute('data-scroll-position', currentPosition);
        carousel.style.transform = `translateX(-${currentPosition * cardWidth}px)`;
    }

    // Optional: Auto-advance carousel
    document.querySelectorAll('.card-carousel').forEach(carousel => {
        setInterval(() => {
            const cardWidth = document.querySelector('.card').offsetWidth + 20;
            const visibleCards = Math.floor(carousel.parentElement.offsetWidth / cardWidth);
            const maxPosition = carousel.children.length - visibleCards;
            let currentPosition = parseInt(carousel.getAttribute('data-scroll-position'));

            currentPosition = (currentPosition + 1) % (maxPosition + 1);
            carousel.setAttribute('data-scroll-position', currentPosition);
            carousel.style.transform = `translateX(-${currentPosition * cardWidth}px)`;
        }, 5000);
    });
</script>
{% endblock %}